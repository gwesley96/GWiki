<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Debug: Combinations</title>
    <link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
    <script src="https://tikzjax.com/v1/tikzjax.js"></script>
    <style>
        .test-case { border: 1px solid #ccc; margin: 20px; padding: 10px; }
        .label { font-weight: bold; }
    </style>
</head>
<body>
    <h1>Combination Tests</h1>

    <div class="test-case">
        <div class="label">1. Patterns + Styles (No CD)</div>
        <script type="text/tikz">
            \usetikzlibrary{patterns,decorations.markings}
            \pgfdeclarepatternformonly{primeddots}{\pgfqpoint{-1pt}{-1pt}}{\pgfqpoint{5pt}{5pt}}{\pgfqpoint{4pt}{4pt}}%
            { \pgfpathcircle{\pgfqpoint{0pt}{0pt}}{.5pt} \pgfusepath{fill} }
            \tikzset{
                primedregion/.style={preaction={fill=#1}, pattern=primeddots},
                arrow at/.style={decoration={markings, mark=at position #1 with {\arrow{>}}}, postaction={decorate}}
            }
            \begin{tikzpicture}
                \fill[pattern=primeddots] (0,0) rectangle (1,1);
                \draw[arrow at=0.5] (2,0) -- (4,0);
            \end{tikzpicture}
        </script>
    </div>

    <div class="test-case">
        <div class="label">2. Styles + CD (No Patterns)</div>
        <script type="text/tikz">
            \usetikzlibrary{decorations.markings, cd, quotes}
            \tikzset{
                arrow at/.style={decoration={markings, mark=at position #1 with {\arrow{>}}}, postaction={decorate}}
            }
            \begin{tikzpicture}
                \draw[arrow at=0.5] (0,0) -- (1,0);
                \begin{tikzcd} A \arrow[r] & B \end{tikzcd}
            \end{tikzpicture}
        </script>
    </div>

    <div class="test-case">
        <div class="label">3. Patterns + CD (No Styles)</div>
        <script type="text/tikz">
            \usetikzlibrary{patterns, cd}
            \pgfdeclarepatternformonly{primeddots}{\pgfqpoint{-1pt}{-1pt}}{\pgfqpoint{5pt}{5pt}}{\pgfqpoint{4pt}{4pt}}%
            { \pgfpathcircle{\pgfqpoint{0pt}{0pt}}{.5pt} \pgfusepath{fill} }
            \begin{tikzpicture}
                \fill[pattern=primeddots] (0,0) rectangle (1,1);
                \begin{tikzcd} A \arrow[r] & B \end{tikzcd}
            \end{tikzpicture}
        </script>
    </div>

    <div class="test-case">
        <div class="label">4. Everything (Full Preamble Simulation)</div>
        <script type="text/tikz">
            \usetikzlibrary{arrows.meta,calc,decorations.pathmorphing,decorations.markings,patterns,positioning,shapes.geometric,quotes,cd}
            \pgfdeclarepatternformonly{primeddots}{\pgfqpoint{-1pt}{-1pt}}{\pgfqpoint{5pt}{5pt}}{\pgfqpoint{4pt}{4pt}}%
            { \pgfpathcircle{\pgfqpoint{0pt}{0pt}}{.5pt} \pgfusepath{fill} }
            \tikzset{
                primedregion/.style={preaction={fill=#1}, pattern=primeddots},
                boxregion/.style={preaction={fill=#1}, draw=#1},
                diagregion/.style={preaction={fill=#1}, draw=#1},
                arrow at/.style={decoration={markings, mark=at position #1 with {\arrow{>}}}, postaction={decorate}},
                arrow at/.default=0.5,
                mid>/.style={arrow at=#1},
                mid>/.default=0.55,
                Rightarrow/.style={double equal sign distance, >={Implies}, ->},
                over/.style={double, draw=white, line width=3pt, double=black},
                coupon/.style={draw=black, fill=white, rounded corners=5pt, thick, inner sep=3pt},
                bullet/.style={circle, fill=#1, draw=#1, inner sep=0pt, minimum size=3pt},
                bullet/.default=black,
            }
            \newcommand{\cpn}[2]{\node[coupon] at #1 {#2};}
            \newcommand{\blt}[1]{\node[bullet] at #1 {};}

            \begin{tikzpicture}
                \fill[primedregion=blue!20] (0,0) rectangle (1,1);
                \draw[thick, mid>] (2,0) -- (3,0);
                \begin{tikzcd} A \arrow[r] & B \end{tikzcd}
            \end{tikzpicture}
        </script>
    </div>
</body>
</html>
